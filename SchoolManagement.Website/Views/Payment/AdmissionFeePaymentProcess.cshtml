@model SchoolManagement.Website.Models.PaymentResultModels
@{
    ViewBag.Title = "PaymentProcess";
    Layout = null;
}

<style>
    .myAlert-bottom {
        position: fixed;
        bottom: 5px;
        left: 2%;
        width: 96%;
    }

    div.fullscreen {
        position: absolute;
        width: 100%;
        height: 960px;
        top: 0;
        left: 0;
        background-color: lightblue;
    }

    .alert {
        display: none;
    }
</style>

<link href="~/Content/bootstrap.css" rel="stylesheet" />
<link href="~/Content/bootstrap.min.css" rel="stylesheet" />
<link href="~/Content/WebsiteCss/css/fontawesome/font-awesome.min.css" rel="stylesheet" />

<div class="right_col" role="main">
    <div class="container-fluid">
        <div class="navbar navbar-fixed-top navbar-default org-titlebar">
            <div class="container">
                <h3 style="padding-left:150px">
                    Nirmala Convent
                    <small style="font-size:60%">Admission Portal</small>
                    <span class="pull-right" style="float:right; padding-right:150px">Hi Guest!</span>
                </h3>
            </div>
        </div>
    </div>
    <div class="row">
        <!-- row started -->
        <div class="col-md-12 col-sm-12 col-xs-12">
            <!-- col-msx-12 started -->
            <div class="dashboard_graph">
                <div class="row x_title">
                    <div class="col-sm-12">
                        <div class="col-sm-2"></div>
                        <div class="col-sm-6" style="margin-top:100px;">
                            <h4 id="HeadingText"> Student Payment  &nbsp;<i class="fa fa-forward"></i></h4>
                        </div>
                        <div class="col-sm-12" style="border-right: 1px solid #eee;">
                            <div class="col-sm-3"></div>
                            <div class="col-sm-6">
                                <form method="post" action="/Payment/PaymentProcess" enctype="multipart/form-data">
                                    <div class="form-group">
                                        <label>Stduent Name :</label>
                                        @Html.Label("Stduent Name", (string)ViewBag.PaymentStudentName)
                                        <input type="hidden" name="StudentName" value="@Model.StudentName" id="StudentName" />
                                    </div>
                                    <div class="form-group">
                                        <label>Class :</label>
                                        @Html.Label("Class", (string)ViewBag.PaymentStudentClass)
                                        <input type="hidden" name="Class" value="@Model.Class" id="Class" />
                                    </div>
                                    <div class="form-group">
                                        <label>Category :</label>
                                        @{
                                            if (ViewBag.PaymentStudentCategory == "NoCast")
                                            {
                                                @Html.Label("Category", (string)ViewBag.PaymentStudentCategory, new { @style = "display:none" })
                                                <input type="hidden" name="Category" value="@Model.Category" id="Category" />
                                            }
                                            else
                                            {
                                                @Html.Label("Category", (string)ViewBag.PaymentStudentCategory)
                                                <input type="hidden" name="Category" value="@Model.Category" id="Category" />
                                            }
                                        }
                                    </div>
                                    <div class="form-group">
                                        <label>Role Number :</label>
                                        @Html.Label("Role Number", (string)ViewBag.PaymentStudentRoleNumber)
                                        <input type="hidden" name="RoleNumber" value="@Model.RoleNumber" id="RoleNumber" />
                                    </div>
                                    <div class="form-group">
                                        <label>Payment Amount :</label>
                                        @Html.Label("Payment Amount", (string)ViewBag.PaymentStudentTCBal)
                                        <input type="hidden" name="TCBal" value="@Model.TCBal" id="TCBal" />
                                        <input type="hidden" name="studentid" value="@Model.studentid" id="studentid" />
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div><!-- dashboard_graph closed-->
            <div class="col-sm-3"></div>
            <div class="col-sm-6">
                @*local*@
                @* <form id="AWLPGPost" action="https://cgt.in.worldline.com/ipg/doMEPayRequest"*@
                @*server*@
                <form @*action="/Payment/CapturePayment"*@
                      method="POST" target="_blank">
                    @*<input type="hidden" id="razorpay_payment_id" name="razorpay_payment_id" />
                        <input type="hidden" id="razorpay_order_id" name="razorpay_order_id" />*@
                    @*<input type="hidden" id="razorpay_signature" name="razorpay_signature" />*@
                    <div class="tab-content tab_sis">
                        <div id="add" class="tab-pane fade in active">
                            <div class="row" style="float:left">
                                @*<input type="submit" class="btn btn-success pull-right" id="rzp-button1" value="Check Out" style="margin-left: 21px;" />*@
                                <button type="submit" id="rzp-button1" class="btn btn-success pull-right">Check Out</button>
                            </div>
                        </div>
                    </div>
                </form>
                <form method="post" action="/Payment/CapturePayment" id="Paymentform" target="_blank" style="display:none" enctype="multipart/form-data">
                    <input type="hidden" id="razorpay_payment_id" name="paymentid" />
                    <input type="hidden" id="razorpay_order_id" name="OrdedrId" />
                    <button type="submit" id="Submitbutton"></button>
                </form>
            </div>
        </div><!-- col-msx-12  closed -->
    </div><!-- 1st row closed -->
</div>


<script src="https://checkout.razorpay.com/v1/checkout.js"></script>

<script>
    var orderId = '@ViewBag.Orderid'
    var options = {
        
        "key": "@Html.DisplayFor(model => model.Key)",
        "amount": "@Html.DisplayFor(model => model.Amount)",
        "currency":"@Html.DisplayFor(model => model.Currency)",
        "name": "@Html.DisplayFor(model => model.StudentName)",
        "description": "Academic Fee",
        "order_id": orderId,
        //"image": "http://example.com/your_logo",
        "prefill": {
            "name": "@Html.DisplayFor(model => model.StudentName)",
            "email": "@Html.DisplayFor(model => model.Email)",
            //"contact": "@Html.DisplayFor(model => model.Contact)",
            "contact": "9999999999",
        },
        "notes": {
            "address": "Hello World"
        },
        "theme": {
            "color": "#3399cc"
        }
    }
    // Boolean whether to show image inside a white frame. (default: true)
    options.theme.image_padding = false;
    options.handler = function (response) {

        
        document.getElementById('razorpay_payment_id').value = response.razorpay_payment_id;
        document.getElementById('razorpay_order_id').value = orderId;
        //document.getElementById('razorpay_signature').value = response.razorpay_signature;
        console.log("razorpay_payment_id", response.razorpay_payment_id);
        console.log("razorpay_order_id", orderId);
        //console.log("razorpay_signature", response.razorpay_signature);
        //document.razorpayForm.submit();
        //$("#paymentform").attr("action", "/Payment/CapturePayment");
        //window.location.href = "/Payment/CapturePayment";
        //document.getElementById("responsebuton").click();
        //checkfunction();
        document.getElementById('Submitbutton').click();
        //document.getElementById("paymentform").action = "/Payment/CapturePayment";
    };
    options.modal = {
        ondismiss: function () {
            console.log("This code runs when the popup is closed");
        },
        // Boolean indicating whether pressing escape key
        // should close the checkout form. (default: true)
        escape: true,
        // Boolean indicating whether clicking translucent blank
        // space outside checkout form should close the form. (default: false)
        backdropclose: false
    };
    var rzp = new Razorpay(options);

    //window.onload = function () {
    //    document.getElementById("rzp-button1").click();
    //}

    document.getElementById('rzp-button1').onclick = function (e) {
        rzp.open();
        e.preventDefault();
    }

    function checkfunction() {
        console.log("After Payment");
        window.location.href = "/Payment/CapturePayment";
    }

</script>