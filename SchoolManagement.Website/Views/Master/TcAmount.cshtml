@model IEnumerable<SchoolManagement.Website.ViewModels.TcAmountViewModel>
@{
    ViewBag.Title = "TcAmount";
    Layout = "~/Views/Shared/_Layout.cshtml";

    var dataList = new SelectList(ViewBag.DataListItems,"Text", "Value");
}

<div class="right_col" role="main">
    <div class="row">
        <div class="col-sm-12">
            <h4 class="std_head well-sm">Data List</h4>
            <form  method="post">
                <div class="col-sm-12" style="border-right: 1px solid #eee;">
                    <div class="col-sm-6">
                        <div class="form-group">
                            <label>Data List :</label>
                            <input type="hidden" id="hdnTypeId"/>
                            @Html.DropDownList("DataListId", dataList, "--select---", new { @Id = "DataListId", @class = "form-control" })
                        </div>
                    </div>
                    <div class="col-sm-6">
                        <div class="form-group">
                            <label>Amount:</label>
                            <input type="number" id="txtAmount" name="Amount" class="form-control" required /><br />
                            <input id="btnSubmit" class="btn btn-success form-control" type="submit" value="Save" />
                        </div>
                    </div>
                </div><!-- col-sm-6 closed -->
            </form>
        </div>

        <div class="col-md-12 col-sm-12 col-xs-12 table-responsive border-bottom">
            <!-- col-msx-12 started -->
            <table class="table table-bordered" id="TblDataList" style="margin-top:5px;">
                <thead>
                    <tr>
                        <th>S.No</th>
                        <th>Type</th>
                        <th>Amount</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    @if (Model != null)
                    {
                        int i = 1;
                        foreach (var v in Model)
                        {

                        <tr>
                            <td>@i</td>
                            <td>@v.TypeName</td>
                            <td>@v.Amount</td>
                            <td>
                            <a href="javascript:void(0)" class="btn btn-success btn-sm btnEdit"  data-val="@v.Id">Edit</a> 
                            <a  href="javascript:void(0)" class="btn btn-danger btn-sm btnDelete" data-val="@v.Id" role="button">Delete</a>
                            </td>
                       
                        </tr>
                            i++;
                        }
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>

@section scripts{
    <script type="text/javascript">
        $('#TblDataList').DataTable();
    </script>
    <script type="text/javascript">
        //update records
        $(".btnEdit").on('click', function () {
            var dataListId = $(this).attr("data-val");
            GetDataListItemById(dataListId);
        });
        function GetDataListItemById(dataListId) {
            $.ajax({
                url: "/Master/TcEdit?id=" + dataListId,
                type: "GET",
                success: function (result) {
                    $("#btnSubmit").val("Update");
                    if (result != null) {
                        $("#hdnTypeId").val(result.Id);
                        $('#DataListId option[value="' + result.Type + '"]').attr("selected", "selected");
                        $('#DataListId').val(result.Type).change();
                        $("#txtAmount").val(result.Amount);
                    }
                },
                error: function (errormessage) {
                    alert(errormessage.responseText);
                }
            });
        }
        $(".btnDelete").on('click', function () {
            var dataListId = $(this).attr("data-val");
            $.ajax({
                url: "/Master/TcAmountDelete?id=" + dataListId,
                type: "GET",
                contentType: "application/json;charset=utf-8",
                dataType: "json",
                success: function (result) {
                    window.location.href = "/master/TcAmount";
                },
                error: function (errormessage) {
                    alert(errormessage.responseText);
                }
            });

        });

        $("#btnSubmit").click(function () {
            var data = {

            }
            if ($(this).val().toLowerCase() == "update")
            {
                 data = {
                    TypeId: $("#DataListId").val(),
                    Amount: $("#txtAmount").val(),
                     IsEdit: true,
                     Id: $("#hdnTypeId").val()
                }
            }
            else
            {
                 data = {
                    TypeId: $("#DataListId").val(),
                    Amount: $("#txtAmount").val(),
                }

            }

            $.ajax({
                url: "/master/TcAmountCreateOrUpdate",
                type: "POST",
                data: data,
                success: function (response) {
                    window.location.href = "/master/TcAmount";
                },
                error: function (ex) {
                    alert(ex);
                }

            });
        });
    </script>
}

