
@{
    ViewBag.Title = "PFCalulationSummary";
}

<div class="right_col" role="main">
    <div class="row">
        <div class="col-sm-12">
            <form action="/Master/AddBasicPay" method="post" id="Basicpayform">
                <div class="col-sm-12" style="border-right:1px solid #eee;">
                    @*<div class="form-group">
                            <input type="hidden" id="BasicAmount_Id" name="BasicAmount_Id" />
                        </div>*@

                    <div class="col-sm-4">
                        <div class="form-group">
                            <label>Date</label>
                            <input type="text" id="Date" readonly class="form-control datepicker" />
                        </div>
                    </div>
                    <div class="col-sm-4">
                        <div class="form-group" style="margin-top:20px">

                            <button type="button" id="BtnFilter" class="btn btn-success">Filter</button>
                        </div>
                    </div>
                    <div class="col-sm-4">
                        <div class="form-group" style="margin-top:20px">
                            <button type="button" id="ExcelDownload" class="btn btn-info">Download</button>
                        </div>
                    </div>
                </div>

            </form>
            <hr />
            <div id="PrintTable">
                <div class="col-md-12 col-sm-12 col-xs-12">

                </div>
                <div class="col-md-12 col-sm-12 col-xs-12 table-responsive border-bottom">
                    <table class="table table-bordered" id="TblSalaryStatement" style="margin-top:5px;">
                        <thead>
                            <tr>
                                <th>Employee Name</th>
                                <th>Employee Code</th>
                                <th>Basic</th>
                                <th>DA</th>
                                <th>HRA</th>
                                <th>CCA</th>
                                <th>OtherAllowances</th>
                                <th>PF</th>
                                <th>ESI</th>
                                <th>LOP</th>
                                <th>Professional Tax</th>
                                <th>Gross</th>
                                <th>Deductions</th>
                                <th>NetPay</th>

                            </tr>
                            @*<tr>
                                    <th>Total</th>
                                </tr>*@
                        </thead>
                        <tbody id="TableBody"></tbody>
                        @*<tbody>
                                @{
                                    int i = 1;
                                    foreach (var item in ViewBag.BasicPayList as IEnumerable<SchoolManagement.Website.Models.Tbl_BasicPayDetails>)
                                    {
                                        <tr>
                                            <td>@i</td>
                                            <td>@item.Basicpay_Name</td>
                                            <td>@item.Basic_Amount</td>
                                        </tr>
                                        i++;
                                    }
                                }
                            </tbody>*@
                    </table>

                    @*<div class="form-group" style="text-align:center">
                            <label>Total :</label>
                            <input type="text" id="Totalval" readonly class="form-control"/>
                        </div>*@
                </div>


            </div>
            <div class="form-group" style="text-align:right;margin-top:10px">
                <button type="button" id="BtnPrint" class="btn btn-success">Print</button>
            </div>

        </div>
    </div>
</div>


<script src="~/Scripts/printThis.js"></script>


<script>
    //$("#TblSalaryStatement").DataTable();
    $("#BtnPrint").on('click', function () {
        //$("#TblSalaryStatement").DataTable().destroy();

        $("#PrintTable").printThis();
        //alert(data);
        //$("#TblSalaryStatement").DataTable();


    });


    //$("#BtnPrint").on('click', function () {
    //    $("#PrintTable").printThis();
    //});

    $("#BtnFilter").on('click', function () {
        //var Staffid = $("#GetStaffData").val();
        //alert(account_Id);
        var Date = $("#Date").val();

        if (Date == "") {
            alert("Please Select Account and Date");
        }
        else {
            var html = "";
            $.ajax({
                url: "/Account/FilterPFSummary",
                data: { Date: Date },
                type: "GET",
                dataType: "json",
                contentType: "application/json;charset=UTF-8",
                success: function (result) {
                    if (result == "Fail") {
                        alert("There is no Data Available in this Date");
                    }
                    else {
                        var TotalBasic = 0;
                        var TotalDA = 0;
                        var TotalHra = 0;
                        var TotaCCA = 0;
                        var TotalOtherAllowance = 0;
                        var Totalpf = 0;
                        var TotalEsi = 0;
                        var TotalLOp = 0;
                        var TotalPTax = 0;
                        var TotalGross = 0;
                        var Totalnetpay = 0;
                        var TotalDeductions = 0;

                        for (var i = 0; i < result.length; i++) {

                            if (result[i].Arrear != "Yes")
                            {
                                html += "<tr>";
                                html += "<td>" + result[i].Staff_Name + "</td>";
                                html += "<td>" + result[i].Staff_Id + "</td>";
                                html += "<td>" + result[i].Basic_Salary + "</td>";
                                TotalBasic = TotalBasic + result[i].Basic_Salary;
                                html += "<td>" + result[i].DA + "</td>";
                                TotalDA = TotalDA + result[i].DA;
                                html += "<td>" + result[i].HRA + "</td>";
                                TotalHra = TotalHra + result[i].HRA;
                                html += "<td>" + result[i].CCA + "</td>";
                                TotaCCA = TotaCCA + result[i].CCA;
                                html += "<td>" + result[i].OtherALlowance + "</td>";
                                TotalOtherAllowance = TotalOtherAllowance + result[i].OtherALlowance;
                                html += "<td>" + result[i].PF + "</td>";
                                Totalpf = Totalpf + result[i].PF;
                                //html += "<td>" + result[i].Employer_Contribution + "</td>";
                                html += "<td>" + result[i].ESI + "</td>";
                                TotalEsi = TotalEsi + result[i].ESI;
                                html += "<td>" + result[i].LOP + "</td>";
                                TotalLOp = TotalLOp + result[i].LOP;
                                html += "<td>" + result[i].Professional_Tax + "</td>";
                                TotalPTax = TotalPTax + result[i].Professional_Tax;
                                html += "<td>" + result[i].Gross + "</td>";
                                TotalGross = TotalGross + result[i].Gross;
                                html += "<td>" + result[i].Deduction_Amt + "</td>";
                                TotalDeductions = TotalDeductions + result[i].Deduction_Amt;
                                html += "<td>" + result[i].Net_Pay + "</td>";
                                Totalnetpay = Totalnetpay + result[i].Net_Pay;
                                html += "</tr>";
                            }
                        }
                        html += "<tr>";
                        html += "<td></td>";
                        html += "<td><b style='color: black;'>Total:</b></td>";
                        html += "<td><b style='color: black;'>" + TotalBasic + "</b></td>";
                        html += "<td><b style='color: black;'>" + TotalDA + "</b></td>";
                        html += "<td><b style='color: black;'>" + TotalHra + "</b></td>";
                        html += "<td><b style='color: black;'>" + TotaCCA + "</b></td>";
                        html += "<td><b style='color: black;'>" + TotalOtherAllowance + "</b></td>";
                        html += "<td><b style='color: black;'>" + Totalpf + "</b></td>";
                        html += "<td><b style='color: black;'>" + TotalEsi + "</b></td>";
                        html += "<td><b style='color: black;'>" + TotalLOp + "</b></td>";
                        html += "<td><b style='color: black;'>" + TotalPTax + "</b></td>";
                        html += "<td><b style='color: black;'>" + TotalGross + "</b></td>";
                        html += "<td><b style='color: black;'>" + TotalDeductions + "</b></td>";
                        html += "<td><b style='color: black;'>" + Totalnetpay + "</b></td>";
                        html += "</tr>";
                        //$("#TblSalaryStatement").DataTable().destroy();
                        $("#TableBody").empty();
                        $("#TableBody").html(html);

                        //$("#TblSalaryStatement").DataTable();
                    }

                },
                error: function (errormessage) {
                    alert(errormessage.responseText);
                }
            });
        }

    });

    $("#ExcelDownload").on('click', function () {
        var Date = $("#Date").val();

        if (Date == "") {
            alert("Please Select Date");
        } else {
            window.location.href = "/Account/ExportPfSummary?date=" + Date;
        }

    });


</script>